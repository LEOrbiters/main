<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>반응형 온보딩 화면</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
    body { font-family: 'Inter', sans-serif; }

    #slide-container { transition: transform 0.5s cubic-bezier(0.25,0.46,0.45,0.94); will-change: transform; }

    #onboarding-overlay { transition: opacity 0.7s ease-in-out, visibility 0.7s ease-in-out; }
    .fade-out { opacity: 0; visibility: hidden; }

    #dashboard-content { transition: opacity 1s ease-in-out; opacity: 0; }
    .fade-in { opacity: 1 !important; }

    .character-svg { width: 320px; height: 320px; margin: 0 auto 32px; }
    @media (min-width: 1024px) {
      .character-svg { 
        width: 100%; 
        aspect-ratio: 1 / 1;
        margin: 0 auto clamp(20px, 3vh, 32px); }
    }
  </style>
</head>
<body class="bg-black">

  <!-- 온보딩 오버레이 -->
  <div id="onboarding-overlay" class="fixed inset-0 z-50 bg-black bg-opacity-80 flex flex-col justify-center items-center p-4">
    <div class="w-full max-w-5xl h-full flex flex-col justify-center items-center">
      <div id="slide-track" class="overflow-hidden w-full h-full flex items-center justify-center">
        <div id="slide-container" class="flex h-full w-full">

          <!-- 1~7 슬라이드 (생략 없이 유지) -->
          <!-- 1 -->
          <div class="slide flex-shrink-0 w-full flex flex-col justify-center items-center text-center text-white p-6 md:p-12 lg:p-20">
            <div class="character-svg"><img src="/images/LEOrbiter_character_image1.png" alt="slide1" class="w-full h-full object-contain"/></div>
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold mb-4 mt-2">Peaceful Orbit</h1>
            <p class="text-base md:text-xl font-light max-w-2xl text-gray-300">Satellites are orbiting Earth, carrying out their missions.</p>
          </div>

          <!-- 2 -->
          <div class="slide flex-shrink-0 w-full flex flex-col justify-center items-center text-center text-white p-6 md:p-12 lg:p-20">
            <div class="character-svg"><img src="/images/LEOrbiter_character_image2.png" alt="slide2" class="w-full h-full object-contain"/></div>
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold mb-4 mt-2">Danger Approaches</h1>
            <p class="text-base md:text-xl font-light max-w-2xl text-gray-300">But suddenly... two satellites move onto a collision course!</p>
          </div>

          <!-- 3 -->
          <div class="slide flex-shrink-0 w-full flex flex-col justify-center items-center text-center text-white p-6 md:p-12 lg:p-20">
            <div class="character-svg"><img src="/images/LEOrbiter_character_image3.png" alt="slide3" class="w-full h-full object-contain"/></div>
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold mb-4 mt-2">Collision!</h1>
            <p class="text-base md:text-xl font-light max-w-2xl text-gray-300">Crash! The impact scatters dangerous debris into space.</p>
          </div>

          <!-- 4 -->
          <div class="slide flex-shrink-0 w-full flex flex-col justify-center items-center text-center text-white p-6 md:p-12 lg:p-20">
            <div class="character-svg"><img src="/images/LEOrbiter_character_image4.png" alt="slide4" class="w-full h-full object-contain"/></div>
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold mb-4 mt-2">Threat of Debris</h1>
            <p class="text-base md:text-xl font-light max-w-2xl text-gray-300">These fragments remain in orbit for decades, threatening other satellites and missions.</p>
          </div>

          <!-- 5 -->
          <div class="slide flex-shrink-0 w-full flex flex-col justify-center items-center text-center text-white p-6 md:p-12 lg:p-20">
            <div class="character-svg"><img src="/images/LEOrbiter_character_image5.png" alt="slide5" class="w-full h-full object-contain"/></div>
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold mb-4 mt-2">Mission Complete</h1>
            <p class="text-base md:text-xl font-light max-w-2xl text-gray-300">Some satellites reach the end of their life and fall back to Earth.</p>
          </div>

          <!-- 6 -->
          <div class="slide flex-shrink-0 w-full flex flex-col justify-center items-center text-center text-white p-6 md:p-12 lg:p-20">
            <div class="character-svg"><img src="/images/LEOrbiter_character_image6.png" alt="slide6" class="w-full h-full object-contain"/></div>
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold mb-4 mt-2">Air Traffic Risk</h1>
            <p class="text-base md:text-xl font-light max-w-2xl text-gray-300">Falling debris can even endanger airplanes flying high in the sky.</p>
          </div>

          <!-- 7 (마지막) -->
          <div class="slide flex-shrink-0 w-full flex flex-col justify-center items-center text-center text-white p-6 md:p-12 lg:p-20">
            <div class="character-svg"><img src="/images/LEOrbiter_character_image7.png" alt="slide7" class="w-full h-full object-contain"/></div>
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold mb-4 mt-2">Prevention with LEOrbiter</h1>
            <p class="text-base md:text-xl font-light max-w-2xl text-gray-300">But with LEOrbiter, we can predict and prevent collisions before they happen!</p>
            <button id="start-button" class="mt-12 px-10 py-4 bg-white text-black text-xl font-bold rounded-full shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-105">
              LEOrbiter START
            </button>
          </div>

        </div>
      </div>

      <!-- 하단 컨트롤 -->
      <div id="bottom-controls" class="absolute bottom-0 left-0 right-0 p-8 flex flex-col items-center">
        <div id="pagination-dots" class="flex space-x-3 mb-6"></div>
        <div class="flex flex-col items-center space-y-3">
          <div id="nav-buttons" class="flex space-x-4">
            <button id="prev-button" class="px-6 py-2 border-2 border-white text-white font-semibold rounded-full hover:bg-white hover:text-black transition duration-300 disabled:opacity-30 disabled:cursor-not-allowed">이전</button>
            <button id="next-button" class="px-6 py-2 bg-white text-black font-semibold rounded-full hover:bg-gray-200 transition duration-300 disabled:opacity-30 disabled:cursor-not-allowed">다음</button>
          </div>
          <button id="skip-button" class="text-xs font-semibold text-gray-400 hover:text-white transition duration-200">건너뛰기</button>
        </div>
      </div>
    </div>
  </div>

  <!-- (옵션) 데모용 뒤 배경. 실제 앱에서는 Flutter가 지도를 렌더하므로 보이지 않음 -->
  <div id="dashboard-content" class="min-h-screen text-white flex flex-col items-center justify-center p-8">
    <!-- Flutter가 화면을 교체하므로 여기 내용은 사용자에게 거의 안 보임 -->
  </div>

  <script>
    const overlay = document.getElementById('onboarding-overlay');
    const slideContainer = document.getElementById('slide-container');
    const slides = document.querySelectorAll('.slide');
    const bottomControls = document.getElementById('bottom-controls');
    const paginationDots = document.getElementById('pagination-dots');
    const prevButton = document.getElementById('prev-button');
    const nextButton = document.getElementById('next-button');
    const startButton = document.getElementById('start-button');
    const skipButton = document.getElementById('skip-button');

    const totalSlides = slides.length;
    let currentSlide = 0;

    let isDragging = false;
    let startX = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    const dragThreshold = 50;

    function endOnboarding() {
      // 1) 비주얼 페이드아웃
      overlay.classList.add('fade-out');
      // 2) Flutter(부모)에게 온보딩 완료 신호 전달 ★핵심
      //    → Flutter의 onboarding_screen.dart에서 이 메시지를 받아 라우팅을 '/'로 교체
      setTimeout(() => {
        try {
          parent.postMessage({ type: 'onboarding:done' }, '*');
        } catch (e) {
          console.error('postMessage failed:', e);
        }
      }, 400); // 애니메이션 자연스럽게 보이도록 약간의 지연
    }

    function goToSlide(index, animated = true) {
      if (index < 0 || index >= totalSlides) return;
      currentSlide = index;
      const slideWidth = slides[0].clientWidth;
      currentTranslate = -currentSlide * slideWidth;
      prevTranslate = currentTranslate;
      slideContainer.style.transition = animated ? 'transform 0.5s cubic-bezier(0.25,0.46,0.45,0.94)' : 'none';
      slideContainer.style.transform = `translateX(${currentTranslate}px)`;
      updateUI();
    }

    function updateUI() {
      const isLastSlide = currentSlide === totalSlides - 1;

      // pagination
      Array.from(paginationDots.children).forEach((dot, i) => {
        dot.classList.toggle('bg-white', i === currentSlide);
        dot.classList.toggle('bg-gray-500', i !== currentSlide);
      });

      // 마지막 슬라이드에서는 하단 컨트롤 숨김
      bottomControls.classList.toggle('hidden', isLastSlide);

      prevButton.disabled = currentSlide === 0;
      nextButton.disabled = isLastSlide;
    }

    function setupPagination() {
      for (let i = 0; i < totalSlides; i++) {
        const dot = document.createElement('div');
        dot.className = 'w-3 h-3 rounded-full cursor-pointer transition-colors duration-300 bg-gray-500';
        dot.addEventListener('click', () => goToSlide(i));
        paginationDots.appendChild(dot);
      }
    }

    function handleResize() { goToSlide(currentSlide, false); }
    function getPositionX(e) { return e.type.includes('mouse') ? e.pageX : e.touches[0].clientX; }
    function startDrag(e) { isDragging = true; startX = getPositionX(e); slideContainer.style.transition = 'none'; }
    function drag(e) {
      if (!isDragging) return;
      e.preventDefault();
      const deltaX = getPositionX(e) - startX;
      currentTranslate = prevTranslate + deltaX;
      slideContainer.style.transform = `translateX(${currentTranslate}px)`;
    }
    function endDrag() {
      if (!isDragging) return;
      isDragging = false;
      const moved = currentTranslate - prevTranslate;
      if (moved < -dragThreshold && currentSlide < totalSlides - 1) goToSlide(currentSlide + 1);
      else if (moved > dragThreshold && currentSlide > 0) goToSlide(currentSlide - 1);
      else goToSlide(currentSlide);
    }

    // 초기화
    setupPagination();
    goToSlide(0);
    prevButton.addEventListener('click', () => goToSlide(currentSlide - 1));
    nextButton.addEventListener('click', () => goToSlide(currentSlide + 1));
    startButton.addEventListener('click', endOnboarding);
    skipButton.addEventListener('click', endOnboarding);

    slideContainer.addEventListener('mousedown', startDrag);
    slideContainer.addEventListener('touchstart', startDrag, { passive: true });

    window.addEventListener('mousemove', drag);
    window.addEventListener('touchmove', drag, { passive: false });

    window.addEventListener('mouseup', endDrag);
    window.addEventListener('touchend', endDrag);

    slides.forEach(s => s.addEventListener('dragstart', e => e.preventDefault()));
    window.addEventListener('resize', handleResize);
  </script>
</body>
</html>
